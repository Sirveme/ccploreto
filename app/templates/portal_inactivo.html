<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tu Portal â€” Colegio Profesional</title>
    <meta name="theme-color" content="#0a0f1e">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/regular/style.css">
    <link rel="stylesheet" href="https://unpkg.com/@phosphor-icons/web@2.0.3/src/fill/style.css">
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,500;9..40,700;9..40,800&family=Playfair+Display:wght@700;800&display=swap" rel="stylesheet">
<style>
/* â”€â”€ RESET & VARS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
*{margin:0;padding:0;box-sizing:border-box}
:root{
    --bg:#0a0f1e;--bg2:#0f172a;--sf:#131c33;--sf2:#1a2542;--sf3:#213054;
    --glow:#3b82f6;--glow2:#6366f1;--warm:#f59e0b;--green:#10b981;--green2:#34d399;
    --red:#f43f5e;--cyan:#06b6d4;--purple:#a78bfa;
    --tx:#f1f5f9;--tx2:#94a3b8;--tx3:#475569;
    --bd:rgba(148,163,184,.07);--bd2:rgba(148,163,184,.12);
    --ff:'DM Sans',sans-serif;--fd:'Playfair Display',serif
}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:var(--ff);-webkit-font-smoothing:antialiased;overflow-x:hidden}

/* â”€â”€ ANIMATIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes fadeUp{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-8px)}}
@keyframes bounce-g{0%,100%{transform:translateY(0)}50%{transform:translateY(-4px)}}
@keyframes pulse-ring{0%{box-shadow:0 0 0 0 rgba(59,130,246,.4)}70%{box-shadow:0 0 0 12px rgba(59,130,246,0)}100%{box-shadow:0 0 0 0 rgba(59,130,246,0)}}
.fade-up{animation:fadeUp .8s ease both}
.fd1{animation-delay:.15s}.fd2{animation-delay:.3s}.fd3{animation-delay:.45s}.fd4{animation-delay:.6s}

/* â”€â”€ TOPBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.topbar{position:fixed;top:0;left:0;right:0;z-index:100;background:rgba(10,15,30,.9);backdrop-filter:blur(20px);border-bottom:1px solid var(--bd);padding:10px 20px;display:flex;align-items:center;justify-content:space-between}
.topbar-brand{display:flex;align-items:center;gap:10px}
.topbar-logo{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,var(--glow),var(--glow2));font-size:16px;color:#fff}
.topbar-name{font-size:13px;font-weight:700}
.topbar-right{display:flex;align-items:center;gap:8px}
.topbar-btn{display:flex;align-items:center;gap:5px;padding:7px 14px;border-radius:8px;font-size:11px;font-weight:600;border:none;cursor:pointer;transition:all .2s}
.topbar-btn.install{background:linear-gradient(135deg,var(--warm),#f97316);color:#fff;animation:bounce-g 2s infinite}
.topbar-btn.logout{background:rgba(244,63,94,.08);color:var(--red);border:1px solid rgba(244,63,94,.15)}
.topbar-btn.logout:hover{background:rgba(244,63,94,.15)}

/* â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero{min-height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:80px 24px 40px;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 80% 50% at 50% 20%,rgba(59,130,246,.07),transparent);pointer-events:none}
.hero::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:120px;background:linear-gradient(to top,var(--bg),transparent);pointer-events:none}
.hero-emoji{font-size:56px;margin-bottom:16px;animation:float 3s ease infinite;display:inline-block}
.hero-greeting{font-size:12px;font-weight:700;color:var(--warm);text-transform:uppercase;letter-spacing:4px;margin-bottom:10px}
.hero-name{font-family:var(--fd);font-size:38px;font-weight:800;line-height:1.15;margin-bottom:16px}
@media(min-width:500px){.hero-name{font-size:52px}}
.hero-sub{font-size:16px;color:var(--tx2);max-width:420px;line-height:1.7;margin:0 auto 32px}
.hero-sub strong{color:var(--tx)}
.hero-ctas{display:flex;flex-direction:column;gap:10px;align-items:center;width:100%;max-width:320px}
.hero-cta{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:15px 32px;border-radius:14px;font-size:15px;font-weight:700;cursor:pointer;border:none;transition:all .25s;text-decoration:none;width:100%}
.hero-cta.primary{background:linear-gradient(135deg,var(--glow),var(--glow2));color:#fff;box-shadow:0 4px 24px rgba(59,130,246,.3);animation:pulse-ring 2.5s infinite}
.hero-cta.primary:hover{transform:translateY(-2px);box-shadow:0 8px 32px rgba(59,130,246,.4)}
.hero-cta.ghost{background:transparent;color:var(--tx2);border:1px solid var(--bd2)}
.hero-cta.ghost:hover{color:var(--tx);border-color:rgba(148,163,184,.3)}
.hero-scroll{margin-top:48px;color:var(--tx3);font-size:11px;display:flex;flex-direction:column;align-items:center;gap:6px;animation:bounce-g 2s infinite}

/* â”€â”€ SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section{padding:60px 20px;max-width:820px;margin:0 auto}
.stag{display:inline-flex;align-items:center;gap:6px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:2px;padding:5px 12px;border-radius:20px;margin-bottom:14px}
.stag.blue{background:rgba(59,130,246,.08);color:var(--glow);border:1px solid rgba(59,130,246,.15)}
.stag.green{background:rgba(16,185,129,.08);color:var(--green);border:1px solid rgba(16,185,129,.15)}
.stag.warm{background:rgba(245,158,11,.08);color:var(--warm);border:1px solid rgba(245,158,11,.15)}
.stag.red{background:rgba(244,63,94,.08);color:var(--red);border:1px solid rgba(244,63,94,.15)}
.stitle{font-family:var(--fd);font-size:28px;font-weight:800;line-height:1.25;margin-bottom:10px}
.sdesc{font-size:14px;color:var(--tx2);line-height:1.7;margin-bottom:28px}
@media(max-width:500px){.stitle{font-size:22px}}

/* â”€â”€ BENEFIT CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.bgrid{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:500px){.bgrid{grid-template-columns:1fr 1fr}}
.bcard{background:var(--sf);border:1px solid var(--bd);border-radius:16px;padding:22px;position:relative;overflow:hidden;transition:all .3s ease}
.bcard:hover{border-color:var(--bd2);transform:translateY(-3px);box-shadow:0 12px 40px rgba(0,0,0,.25)}
.bicon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:22px;margin-bottom:14px}
.btitle{font-size:15px;font-weight:700;margin-bottom:6px}
.bdesc{font-size:12px;color:var(--tx2);line-height:1.6}
.bstat{margin-top:12px;display:flex;align-items:center;gap:6px;font-size:11px;font-weight:600}
.bstat .num{font-size:20px;font-weight:800}

/* â”€â”€ TESTIMONIALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tscroll{display:flex;gap:14px;overflow-x:auto;padding:4px 0 16px;scroll-snap-type:x mandatory;-webkit-overflow-scrolling:touch;scrollbar-width:none}
.tscroll::-webkit-scrollbar{display:none}
.tcard{flex:0 0 280px;scroll-snap-align:start;background:var(--sf);border:1px solid var(--bd);border-radius:16px;padding:20px}
.tquote{font-size:13px;color:var(--tx2);line-height:1.7;font-style:italic;margin-bottom:14px}
.tquote::before{content:'\201C';font-size:28px;color:var(--glow);font-family:var(--fd);line-height:0;vertical-align:-10px;margin-right:4px}
.tauthor{display:flex;align-items:center;gap:10px}
.tavatar{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:14px;color:#fff}
.tname{font-size:13px;font-weight:700}.trole{font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:.5px}

/* â”€â”€ DEUDA SECTION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.dcont{background:var(--sf);border:1px solid var(--bd2);border-radius:20px;overflow:hidden}

/* Header total */
.dhead{padding:20px 24px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--bd);background:linear-gradient(135deg,rgba(244,63,94,.04),rgba(245,158,11,.04))}
.dhead-left{display:flex;align-items:center;gap:12px}
.dhead-icon{width:40px;height:40px;border-radius:12px;background:rgba(245,158,11,.1);display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--warm)}
.dhead-text h3{font-size:15px;font-weight:700}.dhead-text p{font-size:11px;color:var(--tx3)}
.dtotal{font-size:28px;font-weight:800;background:linear-gradient(135deg,var(--warm),var(--red));-webkit-background-clip:text;-webkit-text-fill-color:transparent}

/* Grupos por aÃ±o */
.dyear-group{border-bottom:1px solid var(--bd)}
.dyear-group:last-child{border-bottom:none}
.dyear-header{display:flex;align-items:center;justify-content:space-between;padding:10px 24px;background:rgba(255,255,255,.01);cursor:pointer;user-select:none;transition:background .15s}
.dyear-header:hover{background:rgba(255,255,255,.02)}
.dyear-label{display:flex;align-items:center;gap:8px;font-size:13px;font-weight:700;color:var(--tx2)}
.dyear-label .ybadge{font-size:10px;background:var(--sf3);color:var(--tx3);padding:2px 7px;border-radius:20px;font-weight:600}
.dyear-amount{font-size:14px;font-weight:700;color:var(--tx);font-variant-numeric:tabular-nums}
.dyear-toggle{font-size:14px;color:var(--tx3);transition:transform .25s;margin-left:6px}
.dyear-body{overflow:hidden;max-height:0;transition:max-height .3s ease}
.dyear-body.open{max-height:600px}
.drow{display:flex;align-items:center;padding:10px 24px 10px 40px;border-top:1px solid var(--bd);transition:background .15s}
.drow:hover{background:rgba(255,255,255,.015)}
.dconcept{flex:1;font-size:12px;color:var(--tx2)}
.ddate{font-size:11px;color:var(--tx3);width:64px;text-align:center}
.damount{font-size:13px;font-weight:700;width:88px;text-align:right;font-variant-numeric:tabular-nums}
.dsummary{padding:12px 24px;background:rgba(0,0,0,.15);font-size:11px;color:var(--tx3);text-align:center;border-top:1px solid var(--bd)}

/* â”€â”€ ACTION BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.abtn-grid{display:grid;gap:12px;margin-top:20px}
@media(min-width:500px){.abtn-grid{grid-template-columns:1fr 1fr}}
.abtn{display:flex;align-items:center;gap:14px;padding:18px 20px;background:var(--sf);border:1px solid var(--bd2);border-radius:14px;cursor:pointer;transition:all .25s;text-decoration:none}
.abtn:hover{transform:translateY(-2px);box-shadow:0 8px 30px rgba(0,0,0,.2)}
.abtn.fracc-btn:hover{border-color:var(--glow2)}
.abtn.pay-btn:hover{border-color:var(--green)}
.abtn-icon{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0}
.abtn-text h4{font-size:14px;font-weight:700;margin-bottom:2px}
.abtn-text p{font-size:11px;color:var(--tx2)}

/* â”€â”€ FRACCIONAMIENTO PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.fpanel{background:var(--sf);border:1px solid rgba(99,102,241,.15);border-radius:16px;margin-top:16px;overflow:hidden;max-height:0;opacity:0;transition:max-height .4s ease, opacity .3s ease}
.fpanel.open{max-height:900px;opacity:1}
.ftop{padding:14px 20px;background:rgba(99,102,241,.04);border-bottom:1px solid rgba(99,102,241,.1);display:flex;align-items:center;justify-content:space-between}
.ftop h4{font-size:14px;font-weight:700;color:#818cf8;display:flex;align-items:center;gap:8px}
.fbody{padding:20px}
.fconds{background:var(--bg2);border:1px solid var(--bd);border-radius:12px;padding:14px;margin-bottom:16px}
.fconds h5{font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;font-weight:700}
.fcond{display:flex;align-items:center;gap:8px;padding:3px 0;font-size:12px;color:var(--tx2)}
.fcond i.ok{color:var(--green)}.fcond i.info{color:#818cf8}.fcond i.warn{color:var(--warm)}
.finput{width:100%;padding:12px 14px;background:var(--bg2);border:1px solid var(--bd2);border-radius:10px;color:var(--tx);font-size:14px;font-family:var(--ff)}
.finput:focus{outline:none;border-color:var(--glow)}

/* Plan cards */
.fopts{display:grid;gap:8px}
.fopt{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:var(--bg2);border:2px solid var(--bd);border-radius:10px;cursor:pointer;transition:all .2s}
.fopt:hover{border-color:#818cf8}.fopt.sel{border-color:#818cf8;background:rgba(99,102,241,.07)}
.fopt-n{font-size:14px;font-weight:700}.fopt-d{font-size:11px;color:var(--tx2);margin-top:2px}.fopt-m{font-size:17px;font-weight:800;color:#818cf8}

/* Resumen plan seleccionado */
.fplan-resumen{display:none;background:rgba(99,102,241,.06);border:1px solid rgba(99,102,241,.2);border-radius:12px;padding:14px;margin-top:14px}
.fplan-resumen.visible{display:block}
.fplan-row{display:flex;justify-content:space-between;font-size:12px;padding:3px 0;color:var(--tx2)}
.fplan-row.total{border-top:1px solid rgba(99,102,241,.15);margin-top:4px;padding-top:7px;font-weight:700;color:var(--tx);font-size:13px}
.fplan-meses{display:flex;flex-wrap:wrap;gap:4px;margin-top:10px}
.fplan-mes{background:rgba(99,102,241,.1);border:1px solid rgba(99,102,241,.2);border-radius:6px;padding:3px 8px;font-size:10px;font-weight:600;color:#818cf8}

.fsubmit{width:100%;padding:14px;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;margin-top:14px;background:linear-gradient(135deg,var(--glow),var(--glow2));color:#fff;transition:filter .2s;display:flex;align-items:center;justify-content:center;gap:8px}
.fsubmit:hover{filter:brightness(1.1)}.fsubmit:disabled{opacity:.4;cursor:not-allowed;filter:none}

/* â”€â”€ PAY PANEL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ppanel{background:var(--sf);border:1px solid rgba(16,185,129,.15);border-radius:16px;margin-top:16px;overflow:hidden;max-height:0;opacity:0;transition:max-height .4s ease, opacity .3s ease}
.ppanel.open{max-height:600px;opacity:1}
.ptop{padding:14px 20px;background:rgba(16,185,129,.04);border-bottom:1px solid rgba(16,185,129,.1);display:flex;align-items:center;justify-content:space-between}
.ptop h4{font-size:14px;font-weight:700;color:var(--green2);display:flex;align-items:center;gap:8px}
.pbody{padding:20px}
.paccount{display:flex;align-items:center;gap:12px;padding:12px;background:var(--bg2);border:1px solid var(--bd);border-radius:12px;margin-bottom:8px}
.pbank-icon{width:40px;height:40px;border-radius:10px;background:var(--sf3);display:flex;align-items:center;justify-content:center;font-weight:800;font-size:11px;color:var(--tx2);flex-shrink:0}
.pbank-name{font-size:13px;font-weight:700}.pbank-num{font-size:12px;color:var(--tx2);font-family:monospace}
.pcopy{padding:6px 12px;border-radius:8px;font-size:11px;font-weight:600;background:var(--sf3);border:1px solid var(--bd);color:var(--tx2);cursor:pointer;transition:all .2s;white-space:nowrap}
.pcopy:hover{background:var(--glow);color:#fff;border-color:var(--glow)}
.pmethod-row{display:flex;gap:8px;margin-top:10px}
.pmethod{flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:10px;background:var(--bg2);border:1px solid var(--bd);border-radius:10px;font-size:12px;font-weight:700}

/* â”€â”€ URGENCY BANNER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.urgency{background:linear-gradient(135deg,rgba(244,63,94,.06),rgba(245,158,11,.06));border:1px solid rgba(244,63,94,.15);border-radius:16px;padding:20px;margin-bottom:20px;display:flex;align-items:flex-start;gap:14px}
.urgency-icon{font-size:28px;flex-shrink:0;margin-top:2px}
.urgency h4{font-size:15px;font-weight:700;margin-bottom:4px}
.urgency p{font-size:12px;color:var(--tx2);line-height:1.6}
.urgency-timer{margin-top:8px;font-size:11px;color:var(--warm);font-weight:600}

/* â”€â”€ CHAT FAB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.chat-fab{position:fixed;bottom:24px;right:20px;z-index:150;width:52px;height:52px;border-radius:16px;border:none;background:linear-gradient(135deg,var(--glow),var(--glow2));color:#fff;font-size:22px;cursor:pointer;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 20px rgba(59,130,246,.35);transition:all .25s}
.chat-fab:hover{transform:scale(1.08)}
.chat-win{position:fixed;bottom:86px;right:20px;z-index:160;width:340px;max-height:480px;background:var(--bg2);border:1px solid var(--bd2);border-radius:20px;overflow:hidden;display:none;flex-direction:column;box-shadow:0 20px 60px rgba(0,0,0,.5)}
.chat-win.open{display:flex;animation:fadeUp .3s ease}
@media(max-width:400px){.chat-win{left:10px;right:10px;width:auto;bottom:80px}}
.cw-header{padding:14px 16px;background:var(--sf);border-bottom:1px solid var(--bd);display:flex;align-items:center;gap:10px}
.cw-avatar{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--glow),var(--glow2));display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;flex-shrink:0}
.cw-info h5{font-size:13px;font-weight:700}.cw-info p{font-size:10px;color:var(--green);display:flex;align-items:center;gap:4px}
.cw-info p::before{content:'';width:6px;height:6px;border-radius:50%;background:var(--green);display:inline-block}
.cw-close{margin-left:auto;background:none;border:none;color:var(--tx3);cursor:pointer;font-size:18px;line-height:1}
.cw-msgs{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:10px;min-height:200px}
.cm{max-width:85%;padding:10px 14px;border-radius:14px;font-size:13px;line-height:1.5}
.cm.bot{align-self:flex-start;background:var(--sf);border-bottom-left-radius:4px}
.cm.user{align-self:flex-end;background:var(--glow);color:#fff;border-bottom-right-radius:4px}
.cm .time{font-size:9px;opacity:.5;margin-top:4px;display:block;text-align:right}
.cw-input-bar{padding:10px 14px;border-top:1px solid var(--bd);display:flex;gap:8px;align-items:center}
.cw-input{flex:1;padding:10px 14px;background:var(--sf);border:1px solid var(--bd);border-radius:12px;color:var(--tx);font-size:13px;font-family:var(--ff)}
.cw-input:focus{outline:none;border-color:var(--glow)}
.cw-send{width:38px;height:38px;border-radius:10px;border:none;background:var(--glow);color:#fff;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0}

.portal-footer{text-align:center;padding:40px 20px;font-size:10px;color:var(--tx3)}
.portal-footer a{color:var(--glow);text-decoration:none}

/* PWA BANNER */
.pwa-banner{position:fixed;bottom:0;left:0;right:0;z-index:200;background:linear-gradient(135deg,#1e3a5f,#1a2542);border-top:1px solid rgba(59,130,246,.2);padding:16px 20px;display:none;animation:fadeUp .5s ease}
.pwa-banner.visible{display:flex;align-items:center;gap:14px}
.pwa-icon{width:48px;height:48px;border-radius:14px;flex-shrink:0;background:linear-gradient(135deg,var(--glow),var(--glow2));display:flex;align-items:center;justify-content:center;font-size:24px;color:#fff}
.pwa-text{flex:1}.pwa-title{font-size:14px;font-weight:700}.pwa-desc{font-size:11px;color:var(--tx2);margin-top:2px}
.pwa-btn{padding:10px 20px;border-radius:10px;font-size:13px;font-weight:700;border:none;cursor:pointer;white-space:nowrap;background:linear-gradient(135deg,var(--warm),#f97316);color:#fff}
.pwa-close{background:none;border:none;color:var(--tx3);font-size:18px;cursor:pointer;padding:4px}

/* Scroll reveal */
.reveal{opacity:0;transform:translateY(20px);transition:all .6s ease}
.reveal.in{opacity:1;transform:translateY(0)}
</style>
</head>
<body>

<!-- TOPBAR -->
<div class="topbar">
    <div class="topbar-brand">
        <div class="topbar-logo"><i class="ph ph-buildings"></i></div>
        <span class="topbar-name" id="topbar-org">Colegio Profesional</span>
    </div>
    <div class="topbar-right">
        <button class="topbar-btn install" id="btn-install" style="display:none" onclick="P.installPWA()">
            <i class="ph ph-download-simple"></i> Instalar App
        </button>
        <button class="topbar-btn logout" onclick="P.logout()"><i class="ph ph-sign-out"></i> Salir</button>
    </div>
</div>

<!-- PWA BANNER -->
<div class="pwa-banner" id="pwa-banner">
    <div class="pwa-icon"><i class="ph ph-device-mobile"></i></div>
    <div class="pwa-text"><div class="pwa-title">Instala la app</div><div class="pwa-desc">Recibe notificaciones y accede mÃ¡s rÃ¡pido</div></div>
    <button class="pwa-btn" onclick="P.installPWA()">Instalar</button>
    <button class="pwa-close" onclick="this.parentElement.classList.remove('visible')"><i class="ph ph-x"></i></button>
</div>

<!-- â”€â”€ HERO â”€â”€ -->
<section class="hero" id="hero">
    <div class="hero-emoji fade-up">ğŸ‘‹</div>
    <div class="hero-greeting fade-up fd1">Bienvenido de vuelta</div>
    <h1 class="hero-name fade-up fd2" id="hero-name">Cargando...</h1>
    <p class="hero-sub fade-up fd3">
        Nos alegra verte aquÃ­. Tu <strong>colegio profesional</strong> ha evolucionado con nuevos servicios digitales esperÃ¡ndote. Revisa todo lo que hemos preparado para ti.
    </p>
    <div class="hero-ctas fade-up fd4">
        <a href="#beneficios" class="hero-cta primary"><i class="ph ph-star-four"></i> Descubre los nuevos servicios</a>
        <a href="#deuda" class="hero-cta ghost"><i class="ph ph-arrow-down"></i> Ver mi situaciÃ³n</a>
    </div>
    <div class="hero-scroll"><i class="ph ph-caret-double-down"></i> Desliza para descubrir</div>
</section>

<!-- â”€â”€ BENEFICIOS â”€â”€ -->
<section class="section reveal" id="beneficios">
    <div class="stag blue"><i class="ph ph-sparkle"></i> Nuevos servicios</div>
    <h2 class="stitle">Tu colegio evolucionÃ³.<br>TÃº tambiÃ©n puedes.</h2>
    <p class="sdesc">Estos servicios estÃ¡n disponibles para colegiados hÃ¡biles. Al regularizar tu situaciÃ³n, accedes a todos de inmediato.</p>
    <div class="bgrid">
        <div class="bcard reveal"><div class="bicon" style="background:rgba(167,139,250,.1);color:var(--purple)"><i class="ph ph-bell-ringing"></i></div><div class="btitle">Alertas Tributarias</div><div class="bdesc">Registra los RUCs de tus clientes y recibe avisos antes de cada vencimiento. Nunca mÃ¡s una multa por olvido.</div><div class="bstat" style="color:var(--purple)"><span class="num" id="stat-rucs">847</span>&nbsp;RUCs monitoreados</div></div>
        <div class="bcard reveal"><div class="bicon" style="background:rgba(59,130,246,.1);color:var(--glow)"><i class="ph ph-robot"></i></div><div class="btitle">Asistente IA Contable</div><div class="bdesc">Consulta normas, plazos SUNAT y procedimientos con inteligencia artificial. Respuestas al instante.</div><div class="bstat" style="color:var(--glow)"><span class="num" id="stat-ia">186</span>&nbsp;consultas este mes</div></div>
        <div class="bcard reveal"><div class="bicon" style="background:rgba(16,185,129,.1);color:var(--green)"><i class="ph ph-certificate"></i></div><div class="btitle">Constancia Digital Inmediata</div><div class="bdesc">Descarga tu constancia de habilidad al instante con cÃ³digo QR verificable. Sin trÃ¡mites, sin esperas.</div><div class="bstat" style="color:var(--green)"><i class="ph ph-lightning"></i>&nbsp;EmisiÃ³n en segundos</div></div>
        <div class="bcard reveal"><div class="bicon" style="background:rgba(6,182,212,.1);color:var(--cyan)"><i class="ph ph-users-three"></i></div><div class="btitle">Directorio Profesional</div><div class="bdesc">Apareces en el directorio pÃºblico de contadores hÃ¡biles. Empleadores y clientes te encuentran.</div><div class="bstat" style="color:var(--cyan)"><i class="ph ph-eye"></i>&nbsp;Visible en bÃºsquedas</div></div>
        <div class="bcard reveal"><div class="bicon" style="background:rgba(245,158,11,.1);color:var(--warm)"><i class="ph ph-graduation-cap"></i></div><div class="btitle">Capacitaciones Gratuitas</div><div class="bdesc">Cursos, seminarios y talleres sin costo adicional. MantÃ©n tu formaciÃ³n actualizada.</div><div class="bstat" style="color:var(--warm)"><i class="ph ph-calendar"></i>&nbsp;PrÃ³ximo: <span id="stat-evento">Mar 2026</span></div></div>
        <div class="bcard reveal"><div class="bicon" style="background:rgba(244,63,94,.1);color:var(--red)"><i class="ph ph-shield-warning"></i></div><div class="btitle">Ejercicio Legal Pleno</div><div class="bdesc">Solo hÃ¡biles pueden firmar estados financieros, participar en licitaciones y ejercer sin riesgo de sanciÃ³n.</div><div class="bstat" style="color:var(--red)"><i class="ph ph-warning"></i>&nbsp;Sin habilidad = riesgo legal</div></div>
    </div>
</section>

<!-- â”€â”€ TESTIMONIOS â”€â”€ -->
<section class="section reveal" style="padding-top:20px">
    <div class="stag green"><i class="ph ph-chat-circle-text"></i> Colegas opinan</div>
    <h2 class="stitle">Lo que dicen quienes<br>ya estÃ¡n activos</h2>
    <p class="sdesc">Colegiados hÃ¡biles que aprovechan los nuevos servicios.</p>
    <div class="tscroll">
        <div class="tcard"><div class="tquote">Las alertas tributarias me salvaron de dos multas el mes pasado. Ahora sÃ© exactamente cuÃ¡ndo vence cada obligaciÃ³n de mis clientes.</div><div class="tauthor"><div class="tavatar" style="background:linear-gradient(135deg,var(--purple),#7c3aed)">MR</div><div><div class="tname">MarÃ­a R.</div><div class="trole">Contadora independiente</div></div></div></div>
        <div class="tcard"><div class="tquote">Necesitaba una constancia urgente un domingo. La descarguÃ© en 30 segundos desde el celular. Impresionante el cambio.</div><div class="tauthor"><div class="tavatar" style="background:linear-gradient(135deg,var(--glow),#2563eb)">JL</div><div><div class="tname">Jorge L.</div><div class="trole">Auditor Â· 15 aÃ±os colegiado</div></div></div></div>
        <div class="tcard"><div class="tquote">RegularicÃ© con fraccionamiento y el mismo dÃ­a ya tenÃ­a acceso a todo. El proceso fue muy fÃ¡cil y el equipo fue muy amable.</div><div class="tauthor"><div class="tavatar" style="background:linear-gradient(135deg,var(--warm),#d97706)">AL</div><div><div class="tname">Ana L.</div><div class="trole">Ex-inactiva Â· ahora hÃ¡bil</div></div></div></div>
        <div class="tcard"><div class="tquote">El asistente IA me ayudÃ³ a resolver una consulta tributaria compleja sobre renta de cuarta categorÃ­a en 2 minutos. IncreÃ­ble.</div><div class="tauthor"><div class="tavatar" style="background:linear-gradient(135deg,var(--green),#059669)">CP</div><div><div class="tname">Carlos P.</div><div class="trole">Socio en estudio contable</div></div></div></div>
    </div>
</section>

<!-- â”€â”€ DEUDA â”€â”€ -->
<section class="section" id="deuda" style="padding-top:20px">
    <div class="stag red"><i class="ph ph-path"></i> Tu camino de regreso</div>
    <h2 class="stitle">Regularizar es mÃ¡s<br>fÃ¡cil de lo que crees</h2>
    <p class="sdesc">AquÃ­ estÃ¡ el detalle de tu situaciÃ³n. Tienes opciones flexibles para ponerte al dÃ­a.</p>

    <!-- Urgencia campaÃ±a (visible solo si hay descuento activo) -->
    <div class="urgency reveal" id="urgency-banner" style="display:none">
        <div class="urgency-icon">ğŸ‰</div>
        <div>
            <h4 id="urgency-title">CampaÃ±a activa</h4>
            <p id="urgency-desc">Aprovecha el descuento especial para regularizarte ahora.</p>
            <div class="urgency-timer" id="urgency-timer"></div>
        </div>
    </div>

    <!-- Tabla de deuda consolidada -->
    <div class="dcont reveal" id="deuda-card">
        <div class="dhead">
            <div class="dhead-left">
                <div class="dhead-icon"><i class="ph ph-receipt"></i></div>
                <div class="dhead-text">
                    <h3>Estado de adeudo</h3>
                    <p id="deuda-count">Cargando...</p>
                </div>
            </div>
            <div class="dtotal" id="deuda-total">S/ 0.00</div>
        </div>
        <!-- Grupos por aÃ±o â€” generados por JS -->
        <div id="deuda-grupos"></div>
        <div class="dsummary" id="deuda-summary"></div>
    </div>

    <!-- Botones de acciÃ³n -->
    <div class="abtn-grid">
        <div class="abtn fracc-btn reveal" id="btn-fracc" style="display:none" onclick="P.toggleFracc()">
            <div class="abtn-icon" style="background:rgba(99,102,241,.1);color:var(--glow2)"><i class="ph ph-calculator"></i></div>
            <div class="abtn-text"><h4>Fraccionar mi deuda</h4><p>Cuota inicial + desde S/ 100/mes Â· mÃ¡x. 12 cuotas</p></div>
        </div>
        <div class="abtn pay-btn reveal" onclick="P.togglePayOnline()">
            <div class="abtn-icon" style="background:rgba(16,185,129,.1);color:var(--green)"><i class="ph ph-lightning"></i></div>
            <div class="abtn-text"><h4>Pagar en lÃ­nea</h4><p>Yape Â· Plin Â· Tarjeta â€” activa habilidad al instante</p></div>
        </div>
        <div class="abtn reveal" style="grid-column:1/-1" onclick="P.togglePayOffline()">
            <div class="abtn-icon" style="background:rgba(245,158,11,.1);color:var(--warm)"><i class="ph ph-upload-simple"></i></div>
            <div class="abtn-text"><h4>Reportar pago realizado</h4><p>Transferencia Â· Yape Â· Plin â€” adjunta tu voucher</p></div>
        </div>
    </div>

    <!-- Panel Fraccionamiento -->
    <div class="fpanel" id="fpanel">
        <div class="ftop">
            <h4><i class="ph ph-calculator"></i> Simulador de Fraccionamiento</h4>
            <button onclick="P.toggleFracc()" style="background:none;border:none;color:var(--tx3);cursor:pointer;font-size:20px;line-height:1"><i class="ph ph-x"></i></button>
        </div>
        <div class="fbody">
            <div class="fconds">
                <h5>Condiciones del plan</h5>
                <div class="fcond"><i class="ph-fill ph-check-circle ok"></i> Deuda mÃ­nima para fraccionar: S/ 500</div>
                <div class="fcond"><i class="ph-fill ph-info info"></i> Cuota inicial mÃ­nima: 20% de la deuda total</div>
                <div class="fcond"><i class="ph-fill ph-info info"></i> Cuota mensual mÃ­nima: S/ 100</div>
                <div class="fcond"><i class="ph-fill ph-info info"></i> MÃ¡ximo 12 cuotas mensuales</div>
                <div class="fcond"><i class="ph-fill ph-warning-circle warn"></i> Habilidad temporal: se renueva al pagar cada cuota puntualmente</div>
                <div class="fcond"><i class="ph-fill ph-warning-circle warn"></i> Una cuota impaga revierte a condiciÃ³n inhÃ¡bil</div>
            </div>

            <div style="margin-bottom:16px">
                <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">
                    Cuota inicial (mÃ­nimo: <span id="fmin">S/ 0</span>)
                </label>
                <input type="number" class="finput" id="fini" placeholder="Ingresa el monto inicial" oninput="P.calcF()">
            </div>

            <div style="font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px">Elige tu plan mensual</div>
            <div class="fopts" id="fopts">
                <div style="color:var(--tx3);font-size:12px;text-align:center;padding:12px">
                    Ingresa el monto inicial para ver los planes disponibles
                </div>
            </div>

            <!-- Resumen del plan seleccionado -->
            <div class="fplan-resumen" id="fplan-resumen"></div>

            <button class="fsubmit" id="fsubmit" disabled onclick="P.solicitarF()">
                <i class="ph ph-handshake"></i> Solicitar este fraccionamiento
            </button>
        </div>
    </div>

    <!-- â”€â”€ PANEL: PAGO EN LÃNEA â”€â”€ -->
    <div class="ppanel" id="ppanel-online">
        <div class="ptop">
            <h4><i class="ph ph-lightning"></i> Pago en lÃ­nea â€” ActivaciÃ³n inmediata</h4>
            <button onclick="P.togglePayOnline()" style="background:none;border:none;color:var(--tx3);cursor:pointer;font-size:20px;line-height:1"><i class="ph ph-x"></i></button>
        </div>
        <div class="pbody">
            <!-- Constancia incluida -->
            <div style="background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.15);border-radius:12px;padding:12px 16px;margin-bottom:16px;display:flex;align-items:center;gap:10px">
                <i class="ph ph-certificate" style="font-size:22px;color:var(--green);flex-shrink:0"></i>
                <div>
                    <div style="font-size:13px;font-weight:700;color:var(--green2)">Constancia de habilidad incluida</div>
                    <div style="font-size:11px;color:var(--tx2)">Se emite automÃ¡ticamente al confirmar tu pago</div>
                </div>
            </div>

            <!-- MÃ©todos Izipay -->
            <div style="font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px">Elige tu mÃ©todo</div>
            <div style="display:grid;gap:10px">
                <button onclick="P.pagarIzipay('yape')" style="display:flex;align-items:center;gap:14px;padding:14px 18px;background:var(--bg2);border:1px solid rgba(123,63,228,.3);border-radius:12px;cursor:pointer;transition:all .2s;width:100%" onmouseover="this.style.borderColor='#7b3fe4';this.style.background='rgba(123,63,228,.06)'" onmouseout="this.style.borderColor='rgba(123,63,228,.3)';this.style.background='var(--bg2)'">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#7b3fe4,#5b21b6);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ’œ</div>
                    <div style="text-align:left"><div style="font-size:14px;font-weight:700;color:var(--tx)">Yape</div><div style="font-size:11px;color:var(--tx2)">Pago con cÃ³digo QR Â· Sin comisiÃ³n extra</div></div>
                    <i class="ph ph-arrow-right" style="margin-left:auto;color:var(--tx3)"></i>
                </button>
                <button onclick="P.pagarIzipay('plin')" style="display:flex;align-items:center;gap:14px;padding:14px 18px;background:var(--bg2);border:1px solid rgba(6,182,212,.3);border-radius:12px;cursor:pointer;transition:all .2s;width:100%" onmouseover="this.style.borderColor='#06b6d4';this.style.background='rgba(6,182,212,.06)'" onmouseout="this.style.borderColor='rgba(6,182,212,.3)';this.style.background='var(--bg2)'">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#06b6d4,#0284c7);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ’š</div>
                    <div style="text-align:left"><div style="font-size:14px;font-weight:700;color:var(--tx)">Plin</div><div style="font-size:11px;color:var(--tx2)">Pago con cÃ³digo QR Â· Sin comisiÃ³n extra</div></div>
                    <i class="ph ph-arrow-right" style="margin-left:auto;color:var(--tx3)"></i>
                </button>
                <button onclick="P.pagarIzipay('card')" style="display:flex;align-items:center;gap:14px;padding:14px 18px;background:var(--bg2);border:1px solid rgba(245,158,11,.3);border-radius:12px;cursor:pointer;transition:all .2s;width:100%" onmouseover="this.style.borderColor='#f59e0b';this.style.background='rgba(245,158,11,.06)'" onmouseout="this.style.borderColor='rgba(245,158,11,.3)';this.style.background='var(--bg2)'">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#f59e0b,#d97706);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:20px;flex-shrink:0">ğŸ’³</div>
                    <div style="text-align:left"><div style="font-size:14px;font-weight:700;color:var(--tx)">Tarjeta de crÃ©dito / dÃ©bito</div><div style="font-size:11px;color:var(--tx2)">Visa, Mastercard Â· Procesado por Izipay</div></div>
                    <i class="ph ph-arrow-right" style="margin-left:auto;color:var(--tx3)"></i>
                </button>
            </div>
            <!-- Contenedor del iframe/redirect de Izipay -->
            <div id="izipay-container" style="margin-top:14px"></div>
            <p style="font-size:10px;color:var(--tx3);margin-top:12px;text-align:center">
                <i class="ph ph-lock-simple"></i> Pagos procesados con cifrado SSL Â· Izipay PerÃº
            </p>
        </div>
    </div>

    <!-- â”€â”€ PANEL: REPORTAR PAGO OFFLINE â”€â”€ -->
    <div class="ppanel" id="ppanel-offline" style="border-color:rgba(245,158,11,.15)">
        <div class="ptop" style="background:rgba(245,158,11,.04);border-color:rgba(245,158,11,.1)">
            <h4 style="color:var(--warm)"><i class="ph ph-upload-simple"></i> Reportar pago realizado</h4>
            <button onclick="P.togglePayOffline()" style="background:none;border:none;color:var(--tx3);cursor:pointer;font-size:20px;line-height:1"><i class="ph ph-x"></i></button>
        </div>
        <div class="pbody">
            <!-- Aviso tiempo de validaciÃ³n -->
            <div style="background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.15);border-radius:12px;padding:12px 16px;margin-bottom:16px;display:flex;align-items:flex-start;gap:10px">
                <i class="ph ph-clock" style="font-size:20px;color:var(--warm);flex-shrink:0;margin-top:1px"></i>
                <div>
                    <div style="font-size:13px;font-weight:700;color:var(--warm)">ValidaciÃ³n en hasta 24h</div>
                    <div style="font-size:11px;color:var(--tx2);line-height:1.5">Al aprobar tu pago recibirÃ¡s tu Constancia de Habilidad automÃ¡ticamente en la app.</div>
                </div>
            </div>

            <form id="form-pago-offline" onsubmit="P.enviarPagoOffline(event)">
                <!-- DNI pre-cargado -->
                <div style="margin-bottom:12px">
                    <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">DNI / NÂ° Colegiatura</label>
                    <input type="text" id="off-dni" name="referencia" readonly
                        style="width:100%;padding:11px 14px;background:rgba(245,158,11,.04);border:1px solid rgba(245,158,11,.2);border-radius:10px;color:var(--tx);font-size:14px;font-weight:700;font-family:monospace">
                </div>

                <!-- Concepto -->
                <div style="margin-bottom:12px">
                    <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Â¿QuÃ© estÃ¡s pagando?</label>
                    <select name="concepto_pago" style="width:100%;padding:11px 14px;background:var(--bg2);border:1px solid var(--bd2);border-radius:10px;color:var(--tx);font-size:13px;font-family:var(--ff)">
                        <option value="deuda_total">Deuda total</option>
                        <option value="cuota_parcial">Cuota parcial</option>
                        <option value="cuota_fraccionamiento">Cuota de fraccionamiento</option>
                        <option value="constancia">Solo constancia de habilidad</option>
                    </select>
                </div>

                <!-- Monto y operaciÃ³n -->
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px">
                    <div>
                        <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Monto (S/)</label>
                        <input type="number" name="monto" step="0.01" min="1" placeholder="0.00" required
                            style="width:100%;padding:11px 14px;background:var(--bg2);border:1px solid var(--bd2);border-radius:10px;color:var(--tx);font-size:15px;font-weight:700;font-family:var(--ff)">
                    </div>
                    <div>
                        <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">NÂ° OperaciÃ³n</label>
                        <input type="text" name="numero_operacion" placeholder="Opcional"
                            style="width:100%;padding:11px 14px;background:var(--bg2);border:1px solid var(--bd2);border-radius:10px;color:var(--tx);font-size:13px;font-family:monospace">
                    </div>
                </div>

                <!-- MÃ©todo -->
                <div style="margin-bottom:12px">
                    <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">MÃ©todo usado</label>
                    <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:8px">
                        <label style="display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 6px;background:var(--bg2);border:2px solid var(--bd);border-radius:10px;cursor:pointer;font-size:11px;font-weight:600;color:var(--tx2);transition:all .2s" id="moff-yape">
                            <input type="radio" name="metodo" value="Yape" style="display:none" onchange="P._selMetodoOff('moff-yape')"> ğŸ’œ Yape
                        </label>
                        <label style="display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 6px;background:var(--bg2);border:2px solid var(--bd);border-radius:10px;cursor:pointer;font-size:11px;font-weight:600;color:var(--tx2);transition:all .2s" id="moff-plin">
                            <input type="radio" name="metodo" value="Plin" style="display:none" onchange="P._selMetodoOff('moff-plin')"> ğŸ’š Plin
                        </label>
                        <label style="display:flex;flex-direction:column;align-items:center;gap:4px;padding:10px 6px;background:var(--bg2);border:2px solid var(--bd);border-radius:10px;cursor:pointer;font-size:11px;font-weight:600;color:var(--tx2);transition:all .2s" id="moff-trans">
                            <input type="radio" name="metodo" value="Transferencia" style="display:none" onchange="P._selMetodoOff('moff-trans')"> ğŸ¦ Transf.
                        </label>
                    </div>
                </div>

                <!-- Voucher -->
                <div style="margin-bottom:14px">
                    <label style="display:block;font-size:11px;font-weight:700;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px">Voucher / Captura</label>
                    <label style="display:flex;align-items:center;gap:10px;padding:12px 15px;background:var(--bg2);border:1px dashed rgba(245,158,11,.3);border-radius:10px;cursor:pointer;transition:all .2s" onmouseover="this.style.borderColor='var(--warm)'" onmouseout="this.style.borderColor='rgba(245,158,11,.3)'">
                        <input type="file" name="voucher" accept="image/*" style="display:none" onchange="document.getElementById('off-voucher-txt').textContent=this.files[0]?.name||'Adjuntar voucher'">
                        <i class="ph ph-camera" style="font-size:20px;color:var(--warm)"></i>
                        <span id="off-voucher-txt" style="font-size:12px;color:var(--tx2)">Adjuntar voucher (recomendado)</span>
                    </label>
                </div>

                <!-- Constancia -->
                <div style="background:var(--bg2);border:1px solid var(--bd);border-radius:10px;padding:12px 14px;margin-bottom:14px">
                    <label style="display:flex;align-items:center;gap:10px;cursor:pointer">
                        <input type="checkbox" name="requiere_constancia" value="1" style="width:18px;height:18px;accent-color:var(--green)">
                        <div>
                            <div style="font-size:13px;font-weight:700">ğŸ“œ Solicitar Constancia de Habilidad</div>
                            <div style="font-size:11px;color:var(--tx2)">Se emite al validar tu pago (hasta 24h)</div>
                        </div>
                    </label>
                </div>

                <div id="off-resultado"></div>
                <button type="submit" style="width:100%;padding:14px;border:none;border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;background:linear-gradient(135deg,var(--warm),#f97316);color:#fff;display:flex;align-items:center;justify-content:center;gap:8px">
                    <i class="ph ph-paper-plane-tilt"></i> Enviar reporte de pago
                </button>
            </form>
        </div>
    </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SECCIÃ“N PWA â€” INSTALA LA APP (PERSUASIVA)
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<section class="section" id="instala-app" style="padding-top:20px">
    <div class="stag blue"><i class="ph ph-device-mobile"></i> App gratuita</div>
    <h2 class="stitle">Instala la app y<br>nunca pierdas un aviso</h2>
    <p class="sdesc">
        Recibe tu Constancia de Habilidad directamente en tu celular, alertas de vencimiento y novedades del colegio â€” sin abrir el navegador.
    </p>

    <!-- Video demo -->
    <div style="border-radius:20px;overflow:hidden;background:var(--sf);border:1px solid var(--bd2);margin-bottom:24px;position:relative">
        <video id="pwa-demo-video"
            style="width:100%;display:block;max-height:340px;object-fit:cover"
            autoplay muted loop playsinline
            poster="">
            <!-- Reemplaza src con la URL de tu video -->
            <source src="" type="video/mp4">
        </video>
        <!-- Overlay si no hay video aÃºn -->
        <div id="video-placeholder" style="position:absolute;inset:0;background:linear-gradient(135deg,var(--sf),var(--sf2));display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;padding:40px">
            <i class="ph ph-play-circle" style="font-size:56px;color:var(--glow);opacity:.6"></i>
            <p style="color:var(--tx2);font-size:13px;text-align:center">Video demostrativo de la app<br><span style="color:var(--tx3);font-size:11px">(prÃ³ximamente)</span></p>
        </div>
    </div>

    <!-- Beneficios de instalar -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:24px">
        <div style="background:var(--sf);border:1px solid var(--bd);border-radius:14px;padding:16px">
            <i class="ph ph-bell-ringing" style="font-size:24px;color:var(--glow);display:block;margin-bottom:8px"></i>
            <div style="font-size:13px;font-weight:700;margin-bottom:4px">Alertas push</div>
            <div style="font-size:11px;color:var(--tx2)">Aviso cuando tu pago sea aprobado</div>
        </div>
        <div style="background:var(--sf);border:1px solid var(--bd);border-radius:14px;padding:16px">
            <i class="ph ph-certificate" style="font-size:24px;color:var(--green);display:block;margin-bottom:8px"></i>
            <div style="font-size:13px;font-weight:700;margin-bottom:4px">Constancia al instante</div>
            <div style="font-size:11px;color:var(--tx2)">DescÃ¡rgala sin abrir el navegador</div>
        </div>
        <div style="background:var(--sf);border:1px solid var(--bd);border-radius:14px;padding:16px">
            <i class="ph ph-wifi-slash" style="font-size:24px;color:var(--warm);display:block;margin-bottom:8px"></i>
            <div style="font-size:13px;font-weight:700;margin-bottom:4px">Funciona offline</div>
            <div style="font-size:11px;color:var(--tx2)">Consulta tu estado sin internet</div>
        </div>
        <div style="background:var(--sf);border:1px solid var(--bd);border-radius:14px;padding:16px">
            <i class="ph ph-lock-simple" style="font-size:24px;color:var(--purple);display:block;margin-bottom:8px"></i>
            <div style="font-size:13px;font-weight:700;margin-bottom:4px">Acceso seguro</div>
            <div style="font-size:11px;color:var(--tx2)">Tu sesiÃ³n protegida siempre</div>
        </div>
    </div>

    <!-- BotÃ³n de instalaciÃ³n grande -->
    <div id="pwa-install-section">
        <button id="btn-install-big" onclick="P.installPWA()"
            style="width:100%;padding:18px;border:none;border-radius:16px;font-size:16px;font-weight:800;cursor:pointer;background:linear-gradient(135deg,var(--glow),var(--glow2));color:#fff;display:flex;align-items:center;justify-content:center;gap:10px;box-shadow:0 6px 30px rgba(59,130,246,.35);animation:pulse-ring 2.5s infinite;margin-bottom:10px">
            <i class="ph ph-download-simple" style="font-size:22px"></i> Instalar app gratis
        </button>
        <p style="text-align:center;font-size:11px;color:var(--tx3)">
            <i class="ph ph-info"></i> Sin tienda de apps Â· Directo desde el navegador Â· 0 MB descargados
        </p>
    </div>

    <!-- Fallback si ya estÃ¡ instalada o no soporta PWA -->
    <div id="pwa-installed-msg" style="display:none;text-align:center;padding:16px;background:rgba(16,185,129,.06);border:1px solid rgba(16,185,129,.15);border-radius:12px">
        <i class="ph ph-check-circle" style="font-size:28px;color:var(--green)"></i>
        <p style="font-size:13px;font-weight:700;color:var(--green2);margin-top:6px">Â¡App instalada!</p>
        <p style="font-size:11px;color:var(--tx2)">BÃºscala en tu pantalla de inicio</p>
    </div>
</section>

<div class="portal-footer">
    <p><i class="ph ph-shield-check"></i> Portal seguro Â· <a href="https://duilio.store" target="_blank">ColegiosPro</a></p>
</div>

<!-- Chat FAB -->
<button class="chat-fab" id="chat-fab" onclick="P.toggleChat()">
    <i class="ph ph-chat-circle-dots"></i>
    <span id="chat-badge" style="position:absolute;top:-4px;right:-4px;width:18px;height:18px;border-radius:50%;background:var(--red);font-size:10px;font-weight:700;display:none;align-items:center;justify-content:center;color:#fff">1</span>
</button>
<div class="chat-win" id="chat-win">
    <div class="cw-header">
        <div class="cw-avatar"><i class="ph ph-robot"></i></div>
        <div class="cw-info"><h5>Asistente del Colegio</h5><p>En lÃ­nea</p></div>
        <button class="cw-close" onclick="P.toggleChat()"><i class="ph ph-x"></i></button>
    </div>
    <div class="cw-msgs" id="cw-msgs">
        <div class="cm bot">Â¡Hola! ğŸ‘‹ Soy el asistente del colegio. Puedo ayudarte con dudas sobre tu deuda, fraccionamiento, o cÃ³mo regularizar tu situaciÃ³n.<span class="time">Ahora</span></div>
    </div>
    <div class="cw-input-bar">
        <input class="cw-input" id="cw-input" placeholder="Escribe tu pregunta..." onkeydown="if(event.key==='Enter')P.sendMsg()">
        <button class="cw-send" onclick="P.sendMsg()"><i class="ph ph-paper-plane-tilt"></i></button>
    </div>
</div>

<script>
const MESES = ['','Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];
const MESES_L = ['','Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];

const P = {
    col: null, deudas: [], total: 0, fsel: null, dp: null, ws: null,

    // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async init() {
        try {
            const r = await fetch('/api/portal/mi-perfil');
            if (r.status === 401 || r.status === 422) { location.href = '/'; return; }
            const d = await r.json();
            this.col = d;
            document.getElementById('topbar-org').textContent = d.organizacion || 'Colegio Profesional';
            document.getElementById('hero-name').textContent = d.nombres || d.nombre_completo || d.nombre_corto;
            if (d.condicion === 'habil' || d.condicion === 'vitalicio') { location.href = '/dashboard'; return; }
            this.loadDeuda();
            this.loadStats();
            this.initPWA();
        // Ocultar placeholder de video si hay src
        const vid = document.getElementById('pwa-demo-video');
        const src = vid?.querySelector('source')?.src;
        if (src && !src.endsWith('/')) {
            document.getElementById('video-placeholder').style.display = 'none';
        }
            this.initWS();
        } catch(e) { console.error('[Portal]', e); }
    },

    // â”€â”€ CARGAR DEUDA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async loadDeuda() {
        try {
            const r = await fetch('/api/portal/mi-deuda');
            const d = await r.json();
            this.deudas = d.deudas || [];
            this.total  = d.total  || 0;

            document.getElementById('deuda-total').textContent = `S/ ${this.fmt(this.total)}`;
            document.getElementById('deuda-count').textContent =
                `${d.cantidad} concepto${d.cantidad !== 1 ? 's' : ''} pendiente${d.cantidad !== 1 ? 's' : ''}`;

            if (!this.deudas.length) {
                document.getElementById('deuda-grupos').innerHTML =
                    '<div style="padding:24px;text-align:center;color:var(--green);font-size:15px">âœ… Â¡No tienes deudas pendientes!</div>';
                return;
            }

            // Consolidar por aÃ±o y concepto-tipo
            this._renderDeudaConsolidada(this.deudas, d.total);

            // Fraccionamiento
            if (d.califica_fraccionamiento) {
                document.getElementById('btn-fracc').style.display = 'flex';
                this._prepF();
            }

            // CampaÃ±a / descuento activo
            if (d.campana) this._mostrarCampana(d.campana);

            this.loadAccounts();
        } catch(e) { console.error('[Deuda]', e); }
    },

    // â”€â”€ RENDERIZAR DEUDA CONSOLIDADA POR AÃ‘O â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _renderDeudaConsolidada(deudas, total) {
        // Agrupar por aÃ±o (del campo periodo "01/2025" â†’ 2025, o por due_date)
        const grupos = {}; // { '2025': { label, items: [], subtotal } }

        deudas.forEach(d => {
            // periodo puede ser '2024-01', '2024', '2007' etc. â€” extraer aÃ±o
            let anio = '?';
            if (d.periodo) {
                const m = d.periodo.match(/(\d{4})/);
                if (m) anio = m[1];
            } else if (d.due_date) {
                anio = String(d.due_date).slice(0, 4);
            }
            if (!grupos[anio]) grupos[anio] = { items: [], subtotal: 0 };
            grupos[anio].items.push(d);
            grupos[anio].subtotal += parseFloat(d.balance) || 0;
        });

        // Ordenar por aÃ±o desc (mÃ¡s reciente primero)
        const anios = Object.keys(grupos).sort((a, b) => parseInt(b) - parseInt(a));

        let html = '';
        anios.forEach((anio, idx) => {
            const g = grupos[anio];
            const count = g.items.length;
            // Solo el primer grupo (mÃ¡s reciente) abierto por defecto
            const abierto = idx === 0;
            html += `
                <div class="dyear-group">
                    <div class="dyear-header" onclick="P._toggleYear('y${anio}')">
                        <div class="dyear-label">
                            <i class="ph ph-calendar-blank"></i>
                            ${anio}
                            <span class="ybadge">${count} concepto${count !== 1 ? 's' : ''}</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:4px">
                            <span class="dyear-amount">S/ ${this.fmt(g.subtotal)}</span>
                            <i class="ph ph-caret-down dyear-toggle" id="toggle-y${anio}" style="${abierto ? 'transform:rotate(180deg)' : ''}"></i>
                        </div>
                    </div>
                    <div class="dyear-body ${abierto ? 'open' : ''}" id="y${anio}">
                        ${g.items.map(d => `
                            <div class="drow">
                                <div class="dconcept">${d.concept || d.concepto || ''}</div>
                                <div class="ddate">${d.period_label || d.periodo || ''}</div>
                                <div class="damount" style="color:${parseFloat(d.balance) > 100 ? 'var(--red)' : 'var(--tx)'}">
                                    S/ ${this.fmt(d.balance)}
                                </div>
                            </div>`).join('')}
                    </div>
                </div>`;
        });

        document.getElementById('deuda-grupos').innerHTML = html;

        const nAnios = anios.length;
        document.getElementById('deuda-summary').textContent =
            `Deuda acumulada de ${nAnios} aÃ±o${nAnios !== 1 ? 's' : ''} Â· Regulariza hoy y reactÃ­vate de inmediato`;
    },

    _toggleYear(id) {
        const body   = document.getElementById(id);
        const toggle = document.getElementById('toggle-' + id);
        const open   = body.classList.toggle('open');
        toggle.style.transform = open ? 'rotate(180deg)' : 'rotate(0)';
    },

    // â”€â”€ CAMPAÃ‘A / DESCUENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _mostrarCampana(c) {
        const banner = document.getElementById('urgency-banner');
        document.getElementById('urgency-title').textContent = c.nombre || 'CampaÃ±a activa';
        document.getElementById('urgency-desc').textContent  = c.descripcion || '';
        if (c.fecha_fin) {
            document.getElementById('urgency-timer').textContent =
                `â± VÃ¡lido hasta: ${c.fecha_fin}`;
        }
        banner.style.display = 'flex';
        banner.classList.add('reveal');
    },

    // â”€â”€ FRACCIONAMIENTO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    _prepF() {
        const minIni = Math.ceil(this.total * 0.20);
        document.getElementById('fmin').textContent = `S/ ${this.fmt(minIni)}`;
        const inp = document.getElementById('fini');
        inp.min   = minIni;
        inp.value = minIni;
        this.calcF();
    },

    calcF() {
        const ini    = parseFloat(document.getElementById('fini').value) || 0;
        const minIni = Math.ceil(this.total * 0.20);
        const opts   = document.getElementById('fopts');
        const resumen = document.getElementById('fplan-resumen');

        if (ini < minIni) {
            opts.innerHTML = `<div style="color:var(--red);font-size:12px;padding:8px">
                MÃ­nimo requerido: S/ ${this.fmt(minIni)}
            </div>`;
            document.getElementById('fsubmit').disabled = true;
            resumen.classList.remove('visible');
            this.fsel = null;
            return;
        }

        const saldo = this.total - ini;
        const planes = [];
        for (let n = 2; n <= 12; n++) {
            const cuota = saldo / n;
            if (cuota >= 100) planes.push({ n, cuota: Math.ceil(cuota * 100) / 100 });
        }

        if (!planes.length) {
            opts.innerHTML = `<div style="color:var(--warm);font-size:12px;padding:8px">
                Con esa cuota inicial no hay planes disponibles (cuota mÃ­nima S/ 100).
            </div>`;
            document.getElementById('fsubmit').disabled = true;
            resumen.classList.remove('visible');
            this.fsel = null;
            return;
        }

        opts.innerHTML = planes.map(p => `
            <div class="fopt" onclick="P.selF(${p.n}, ${p.cuota}, this)">
                <div>
                    <div class="fopt-n">${p.n} cuotas mensuales</div>
                    <div class="fopt-d">de S/ ${this.fmt(p.cuota)} cada una</div>
                </div>
                <div class="fopt-m">S/ ${this.fmt(p.cuota)}/mes</div>
            </div>`).join('');

        this.fsel = null;
        document.getElementById('fsubmit').disabled = true;
        resumen.classList.remove('visible');
    },

    selF(n, cuota, el) {
        document.querySelectorAll('.fopt').forEach(o => o.classList.remove('sel'));
        el.classList.add('sel');
        this.fsel = { n, cuota };
        document.getElementById('fsubmit').disabled = false;

        // Mostrar cronograma resumido
        const ini    = parseFloat(document.getElementById('fini').value);
        const hoy    = new Date();
        const meses  = [];
        for (let i = 1; i <= n; i++) {
            const d = new Date(hoy.getFullYear(), hoy.getMonth() + i, 1);
            meses.push(MESES[d.getMonth() + 1] + ' ' + d.getFullYear());
        }
        const resumen = document.getElementById('fplan-resumen');
        resumen.innerHTML = `
            <div class="fplan-row"><span>Cuota inicial (hoy)</span><span>S/ ${this.fmt(ini)}</span></div>
            <div class="fplan-row"><span>${n} cuotas de</span><span>S/ ${this.fmt(cuota)}/mes</span></div>
            <div class="fplan-row total"><span>Total a pagar</span><span>S/ ${this.fmt(ini + n * cuota)}</span></div>
            <div style="margin-top:10px;font-size:11px;color:var(--tx3);margin-bottom:6px">Cronograma:</div>
            <div class="fplan-meses">${meses.map(m => `<span class="fplan-mes">${m}</span>`).join('')}</div>
            <div style="margin-top:10px;font-size:11px;color:var(--green);display:flex;align-items:center;gap:5px">
                <i class="ph ph-check-circle"></i> Al pagar la inicial te reactivamos de inmediato
            </div>`;
        resumen.classList.add('visible');
    },

    toggleFracc() {
        const p = document.getElementById('fpanel');
        p.classList.toggle('open');
        if (p.classList.contains('open')) {
            document.getElementById('ppanel').classList.remove('open');
        }
    },
    togglePayOnline() {
        const p  = document.getElementById('ppanel-online');
        const po = document.getElementById('ppanel-offline');
        const fp = document.getElementById('fpanel');
        const open = p.classList.toggle('open');
        if (open) { po.classList.remove('open'); fp.classList.remove('open'); }
        if (open) p.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    },

    togglePayOffline() {
        const p  = document.getElementById('ppanel-offline');
        const po = document.getElementById('ppanel-online');
        const fp = document.getElementById('fpanel');
        const open = p.classList.toggle('open');
        if (open) { po.classList.remove('open'); fp.classList.remove('open'); }
        // Pre-cargar DNI + matrÃ­cula
        if (open && this.col) {
            const ref = document.getElementById('off-dni');
            if (ref) ref.value = `${this.col.dni || ''} / ${this.col.matricula || ''}`;
        }
        if (open) p.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    },

    _selMetodoOff(activeId) {
        ['moff-yape','moff-plin','moff-trans'].forEach(id => {
            const el = document.getElementById(id);
            if (!el) return;
            el.style.borderColor   = id === activeId ? 'var(--glow)' : 'var(--bd)';
            el.style.background    = id === activeId ? 'rgba(59,130,246,.08)' : 'var(--bg2)';
            el.style.color         = id === activeId ? 'var(--tx)' : 'var(--tx2)';
        });
    },

    pagarIzipay(metodo) {
        // Placeholder â€” integrar con SDK Izipay cuando estÃ© disponible
        // metodo: 'yape' | 'plin' | 'card'
        const c = document.getElementById('izipay-container');
        c.innerHTML = `
            <div style="background:rgba(59,130,246,.06);border:1px solid rgba(59,130,246,.15);border-radius:12px;padding:20px;text-align:center">
                <i class="ph ph-spinner ph-spin" style="font-size:28px;color:var(--glow)"></i>
                <p style="margin:10px 0 4px;font-size:13px;font-weight:700">Conectando con Izipayâ€¦</p>
                <p style="font-size:11px;color:var(--tx2)">IntegraciÃ³n de pasarela pendiente de configuraciÃ³n</p>
            </div>`;
        // TODO: llamar a /api/portal/pago-online/iniciar con { metodo, monto: this.total }
    },

    async enviarPagoOffline(e) {
        e.preventDefault();
        const form = e.target;
        const btn  = form.querySelector('[type=submit]');
        const res  = document.getElementById('off-resultado');
        btn.disabled = true;
        btn.innerHTML = '<i class="ph ph-spinner ph-spin"></i> Enviandoâ€¦';
        try {
            const fd = new FormData(form);
            fd.append('colegiado_id', this.col?.id || '');
            const r = await fetch('/pagos/registrar', { method: 'POST', body: fd });
            if (r.ok) {
                res.innerHTML = `<div style="background:rgba(16,185,129,.08);border:1px solid rgba(16,185,129,.2);border-radius:10px;padding:14px;text-align:center;margin-bottom:10px">
                    <i class="ph ph-check-circle" style="font-size:28px;color:var(--green)"></i>
                    <p style="font-size:13px;font-weight:700;color:var(--green2);margin:6px 0 2px">Â¡Reporte enviado!</p>
                    <p style="font-size:11px;color:var(--tx2)">Tu pago serÃ¡ validado en hasta 24h. RecibirÃ¡s una notificaciÃ³n.</p>
                </div>`;
                form.reset();
            } else {
                const html = await r.text();
                res.innerHTML = html;
                btn.disabled = false;
                btn.innerHTML = '<i class="ph ph-paper-plane-tilt"></i> Enviar reporte de pago';
            }
        } catch(err) {
            res.innerHTML = `<p style="color:var(--red);font-size:12px">âŒ Error de conexiÃ³n. Intenta de nuevo.</p>`;
            btn.disabled = false;
            btn.innerHTML = '<i class="ph ph-paper-plane-tilt"></i> Enviar reporte de pago';
        }
    },

    // Activa el panel de pago con instrucciones especÃ­ficas para la cuota inicial
    _activarPanelPagoFracc(plan) {
        const ptop = document.querySelector('.ptop h4');
        if (ptop) ptop.innerHTML = `<i class="ph ph-credit-card"></i> Pagar cuota inicial Â· S/ ${this.fmt(plan.cuota_inicial)}`;

        // AÃ±adir nota de referencia con nÃºmero de solicitud
        const pbody = document.querySelector('.pbody p');
        if (pbody) pbody.innerHTML = `
            Indica <strong>${this.col?.numero_colegiatura || 'tu NÂ° de colegiatura'}</strong>
            y el cÃ³digo <strong>${plan.numero_solicitud}</strong> como referencia al transferir.
        `;

        document.getElementById('ppanel').classList.add('open');
        document.getElementById('ppanel').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    },

    async solicitarF() {
        if (!this.fsel) return;
        const ini = parseFloat(document.getElementById('fini').value);
        const btn = document.getElementById('fsubmit');
        btn.disabled  = true;
        btn.innerHTML = '<i class="ph ph-circle-notch" style="animation:spin 1s linear infinite"></i> Procesando...';
        try {
            const r = await fetch('/api/portal/fraccionamiento/crear', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    colegiado_id: this.col.id,
                    cuota_inicial: ini,
                    num_cuotas: this.fsel.n,
                    notas: 'Portal web'
                })
            });
            const d = await r.json();
            if (d.success) {
                // Guardar datos del plan para el formulario de pago
                this.planActivo = {
                    fraccionamiento_id: d.fraccionamiento_id,
                    numero_cuota:       0,                       // cuota inicial
                    monto:              d.cuota_inicial,
                    numero_solicitud:   d.numero_solicitud,
                };
                this.toggleFracc();
                this._activarPanelPagoFracc(d);
                this._showToast(`Plan ${d.numero_solicitud} creado. Â¡Realiza el pago inicial para reactivarte!`, 'success');
            } else {
                this._showToast(d.detail || d.mensaje || 'Error al procesar', 'error');
            }
        } catch(e) {
            this._showToast('Error de conexiÃ³n. Intenta de nuevo.', 'error');
        }
        btn.disabled  = false;
        btn.innerHTML = '<i class="ph ph-handshake"></i> Solicitar este fraccionamiento';
    },

    // â”€â”€ CUENTAS DE PAGO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async loadAccounts() {
        try {
            const r = await fetch('/api/portal/cuentas-pago');
            const d = await r.json();
            if (d.cuentas?.length) {
                document.getElementById('pay-accounts').innerHTML = d.cuentas.map(c => `
                    <div class="paccount">
                        <div class="pbank-icon">${(c.banco || 'BCO').substring(0, 3).toUpperCase()}</div>
                        <div style="flex:1">
                            <div class="pbank-name">${c.banco}</div>
                            <div class="pbank-num">${c.numero_cuenta}</div>
                        </div>
                        <button class="pcopy" onclick="navigator.clipboard.writeText('${c.numero_cuenta}');this.innerHTML='<i class=\\'ph ph-check\\'></i> Copiado';setTimeout(()=>this.innerHTML='Copiar',2000)">Copiar</button>
                    </div>`).join('');
            }
        } catch(e) {}
    },

    // â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async loadStats() {
        try {
            const r = await fetch('/api/portal/stats-servicios');
            const d = await r.json();
            if (d.rucs_monitoreados) document.getElementById('stat-rucs').textContent = d.rucs_monitoreados;
            if (d.consultas_ia_mes)  document.getElementById('stat-ia').textContent   = d.consultas_ia_mes;
            if (d.proximo_evento)    document.getElementById('stat-evento').textContent = d.proximo_evento;
        } catch(e) {}
    },

    // â”€â”€ WEBSOCKET â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    initWS() {
        const proto = location.protocol === 'https:' ? 'wss' : 'ws';
        try {
            this.ws = new WebSocket(`${proto}://${location.host}/ws/chat`);
            this.ws.onmessage = e => {
                const m = JSON.parse(e.data);
                this.addMsg(m.text, 'bot');
                const win = document.getElementById('chat-win');
                if (!win.classList.contains('open')) {
                    const b = document.getElementById('chat-badge');
                    b.textContent = (parseInt(b.textContent) || 0) + 1;
                    b.style.display = 'flex';
                }
            };
            this.ws.onclose = () => setTimeout(() => this.initWS(), 5000);
        } catch(e) {}
    },

    toggleChat() {
        const w = document.getElementById('chat-win');
        w.classList.toggle('open');
        if (w.classList.contains('open')) {
            document.getElementById('chat-badge').style.display = 'none';
            document.getElementById('cw-input').focus();
        }
    },
    sendMsg() {
        const inp = document.getElementById('cw-input');
        const t = inp.value.trim();
        if (!t) return;
        this.addMsg(t, 'user');
        inp.value = '';
        if (this.ws && this.ws.readyState === WebSocket.OPEN) {
            this.ws.send(JSON.stringify({ text: t, colegiado_id: this.col?.id }));
        } else {
            setTimeout(() => this.addMsg('Puedes comunicarte con la oficina del colegio para resolver tus dudas.', 'bot'), 700);
        }
    },
    addMsg(t, type) {
        const el  = document.getElementById('cw-msgs');
        const now = new Date().toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit' });
        el.innerHTML += `<div class="cm ${type}">${t}<span class="time">${now}</span></div>`;
        el.scrollTop  = el.scrollHeight;
    },

    // â”€â”€ PWA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    initPWA() {
        window.addEventListener('beforeinstallprompt', e => {
            e.preventDefault();
            this.dp = e;
            document.getElementById('btn-install').style.display = 'flex';
            document.getElementById('pwa-banner').classList.add('visible');
        });
        window.addEventListener('appinstalled', () => {
            document.getElementById('pwa-install-section').style.display = 'none';
            document.getElementById('pwa-installed-msg').style.display  = 'block';
            document.getElementById('pwa-banner').classList.remove('visible');
            document.getElementById('btn-install').style.display = 'none';
        });
        if (window.matchMedia('(display-mode: standalone)').matches) {
            const s = document.getElementById('pwa-install-section');
            const m = document.getElementById('pwa-installed-msg');
            if (s) s.style.display = 'none';
            if (m) m.style.display = 'block';
        }
    },
    async installPWA() {
        if (!this.dp) return;
        this.dp.prompt();
        const r = await this.dp.userChoice;
        if (r.outcome === 'accepted') {
            document.getElementById('btn-install').style.display = 'none';
            document.getElementById('pwa-banner').classList.remove('visible');
            document.getElementById('pwa-install-section').style.display = 'none';
            document.getElementById('pwa-installed-msg').style.display  = 'block';
        }
        this.dp = null;
    },

    // â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    logout() { location.href = '/auth/logout'; },
    fmt(n) {
        return (parseFloat(n) || 0).toLocaleString('es-PE', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    },
    _showToast(msg, type = 'info') {
        const t = document.createElement('div');
        const colors = { success: 'var(--green)', error: 'var(--red)', info: 'var(--glow)' };
        t.style.cssText = `position:fixed;bottom:80px;left:50%;transform:translateX(-50%);background:var(--sf);border:1px solid ${colors[type]};color:var(--tx);padding:12px 20px;border-radius:12px;font-size:13px;z-index:300;box-shadow:0 8px 30px rgba(0,0,0,.3);max-width:90vw;text-align:center`;
        t.textContent = msg;
        document.body.appendChild(t);
        setTimeout(() => t.remove(), 4000);
    },
};

document.addEventListener('DOMContentLoaded', () => P.init());

// Scroll reveal
const obs = new IntersectionObserver(entries => {
    entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('in'); });
}, { threshold: 0.1 });
document.querySelectorAll('.reveal').forEach(el => obs.observe(el));

// Spin keyframe
const style = document.createElement('style');
style.textContent = '@keyframes spin{to{transform:rotate(360deg)}}';
document.head.appendChild(style);
</script>
</body>
</html>